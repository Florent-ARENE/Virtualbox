<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordFinder - Interface S√©quentielle</title>
    <link rel="stylesheet" href="/ChordFinder/static/css/style.css">
    <style>
        /* Styles sp√©cifiques pour l'interface s√©quentielle */
        .sequential-interface {
            max-width: 800px;
            margin: 0 auto;
        }

        .string-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .string-nav-btn {
            background: var(--background-light);
            border: 2px solid #bdc3c7;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .string-nav-btn:hover {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-hover);
        }

        .string-nav-btn.current {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-hover);
            transform: scale(1.1);
        }

        .string-nav-btn.completed {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-hover);
        }

        .current-string-display {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius-large);
            border-left: 4px solid var(--secondary-color);
        }

        .current-string-label {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .current-string-note {
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-hover));
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px;
        }

        .navigation-arrows {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .nav-arrow {
            background: var(--background-light);
            border: 2px solid #bdc3c7;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-arrow:hover:not(:disabled) {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-hover);
            transform: scale(1.05);
        }

        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .fret-selection-area {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius-large);
            box-shadow: 0 8px 25px var(--shadow-light);
            margin-bottom: 30px;
        }

        .single-fret-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 12px;
            max-width: 600px;
            margin: 0 auto;
        }

        .single-fret-button {
            border: 2px solid #bdc3c7;
            background: var(--background-light);
            color: var(--text-color);
            padding: 15px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 1rem;
            min-height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .single-fret-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px var(--shadow-medium);
        }

        .single-fret-button.not-played {
            background: linear-gradient(135deg, var(--accent-color), #c0392b);
            color: white;
            border-color: var(--accent-hover);
        }

        .single-fret-button.open {
            background: linear-gradient(135deg, var(--warning-color), #d68910);
            color: white;
            border-color: var(--warning-hover);
        }

        .single-fret-button.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }

        .progress-indicator {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--background-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .chord-summary {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .chord-string-display {
            text-align: center;
            padding: 15px 10px;
            background: white;
            border-radius: var(--border-radius);
            border: 2px solid var(--background-light);
            transition: var(--transition);
            cursor: pointer;
        }

        .chord-string-display:hover {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.05);
            transform: translateY(-1px);
        }

        .chord-string-display.current-editing {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .chord-string-display.completed {
            border-color: var(--primary-color);
            background: rgba(46, 204, 113, 0.1);
        }

        .string-number {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .string-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color);
            font-family: 'Courier New', monospace;
        }

        .string-name {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .single-fret-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            
            .single-fret-button {
                padding: 12px 8px;
                font-size: 0.9rem;
                min-height: 45px;
            }
            
            .chord-summary {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container sequential-interface">
        <h1>üé∏ ChordFinder</h1>
        <p class="subtitle">Interface s√©quentielle - s√©lectionnez corde par corde</p>
        
        <div class="instructions">
            <h3>üìù Comment utiliser :</h3>
            <ul>
                <li><strong>S√©lectionnez une position</strong> pour la corde courante (passage automatique √† la suivante)</li>
                <li><strong>Fl√®ches ‚Üê‚Üí</strong> pour naviguer entre les cordes</li>
                <li><strong>Cliquez sur une case</strong> dans "Accord actuel" pour modifier cette corde directement</li>
                <li><strong>Touches clavier</strong> : ‚Üê et ‚Üí pour naviguer rapidement</li>
            </ul>
        </div>

        <!-- Affichage des erreurs -->
        {% if error_message %}
            <div class="error">{{ error_message }}</div>
        {% endif %}

        <!-- Indicateur de progression -->
        <div class="progress-indicator">
            <span id="progressText">Corde 1 sur 6</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 16.67%"></div>
        </div>

        <!-- Affichage corde courante -->
        <div class="current-string-display">
            <div class="current-string-label" id="currentStringLabel">Corde 6</div>
            <div class="current-string-note" id="currentStringNote">Mi grave</div>
            <div class="navigation-arrows">
                <button class="nav-arrow" id="prevArrow" disabled>‚Üê</button>
                <button class="nav-arrow" id="nextArrow" disabled>‚Üí</button>
            </div>
        </div>

        <!-- Zone de s√©lection des frettes -->
        <div class="fret-selection-area">
            <div class="single-fret-grid" id="fretGrid">
                <button type="button" class="single-fret-button not-played" data-value="x">X</button>
                <button type="button" class="single-fret-button open" data-value="0">0</button>
                <button type="button" class="single-fret-button" data-value="1">1</button>
                <button type="button" class="single-fret-button" data-value="2">2</button>
                <button type="button" class="single-fret-button" data-value="3">3</button>
                <button type="button" class="single-fret-button" data-value="4">4</button>
                <button type="button" class="single-fret-button" data-value="5">5</button>
                <button type="button" class="single-fret-button" data-value="6">6</button>
                <button type="button" class="single-fret-button" data-value="7">7</button>
                <button type="button" class="single-fret-button" data-value="8">8</button>
                <button type="button" class="single-fret-button" data-value="9">9</button>
                <button type="button" class="single-fret-button" data-value="10">10</button>
                <button type="button" class="single-fret-button" data-value="11">11</button>
                <button type="button" class="single-fret-button" data-value="12">12</button>
                <button type="button" class="single-fret-button" data-value="13">13</button>
                <button type="button" class="single-fret-button" data-value="14">14</button>
                <button type="button" class="single-fret-button" data-value="15">15</button>
                <button type="button" class="single-fret-button" data-value="16">16</button>
                <button type="button" class="single-fret-button" data-value="17">17</button>
                <button type="button" class="single-fret-button" data-value="18">18</button>
                <button type="button" class="single-fret-button" data-value="19">19</button>
                <button type="button" class="single-fret-button" data-value="20">20</button>
                <button type="button" class="single-fret-button" data-value="21">21</button>
                <button type="button" class="single-fret-button" data-value="22">22</button>
                <button type="button" class="single-fret-button" data-value="23">23</button>
                <button type="button" class="single-fret-button" data-value="24">24</button>
                <button type="button" class="single-fret-button" data-value="25">25</button>
                <button type="button" class="single-fret-button" data-value="26">26</button>
            </div>
        </div>

        <!-- R√©sum√© de l'accord -->
        <div class="selected-values">
            <h3>üéµ Accord actuel :</h3>
            <div class="chord-summary">
                <div class="chord-string-display current-editing" data-string="0">
                    <div class="string-number">Corde 6</div>
                    <div class="string-value" id="stringValue0">-</div>
                    <div class="string-name">Mi grave</div>
                </div>
                <div class="chord-string-display" data-string="1">
                    <div class="string-number">Corde 5</div>
                    <div class="string-value" id="stringValue1">-</div>
                    <div class="string-name">La</div>
                </div>
                <div class="chord-string-display" data-string="2">
                    <div class="string-number">Corde 4</div>
                    <div class="string-value" id="stringValue2">-</div>
                    <div class="string-name">R√©</div>
                </div>
                <div class="chord-string-display" data-string="3">
                    <div class="string-number">Corde 3</div>
                    <div class="string-value" id="stringValue3">-</div>
                    <div class="string-name">Sol</div>
                </div>
                <div class="chord-string-display" data-string="4">
                    <div class="string-number">Corde 2</div>
                    <div class="string-value" id="stringValue4">-</div>
                    <div class="string-name">Si</div>
                </div>
                <div class="chord-string-display" data-string="5">
                    <div class="string-number">Corde 1</div>
                    <div class="string-value" id="stringValue5">-</div>
                    <div class="string-name">Mi aigu</div>
                </div>
            </div>
        </div>

        <form id="chordForm" method="POST" onsubmit="return submitForm();">
            <!-- Champs cach√©s -->
            <input type="hidden" name="string0" id="string0">
            <input type="hidden" name="string1" id="string1">
            <input type="hidden" name="string2" id="string2">
            <input type="hidden" name="string3" id="string3">
            <input type="hidden" name="string4" id="string4">
            <input type="hidden" name="string5" id="string5">

            <button type="submit" class="submit-button" id="submitButton" disabled>
                üîç Trouver l'accord
            </button>
            
            <button type="button" class="submit-button" id="shareButton" 
                    style="background: linear-gradient(135deg, var(--secondary-color), var(--secondary-hover)); margin-top: 15px;">
                üîó Partager cet accord
            </button>
            
            <button type="button" class="submit-button" id="clearButton" 
                    style="background: linear-gradient(135deg, var(--accent-color), var(--accent-hover)); margin-top: 15px;">
                üóëÔ∏è Effacer tout
            </button>
        </form>

        <!-- Point d'ancrage pour le scroll -->
        <div id="scroll-anchor" style="padding-top: 20px;"></div>

        <!-- Modale de chargement -->
        <div class="modal" id="loaderModal">
            <div class="modal-content">
                <h2>Recherche en cours...</h2>
                <div class="loader"></div>
            </div>
        </div>

        <!-- Affichage des r√©sultats (identique √† l'original) -->
        {% if exact_matches %}
            <div id="results" class="result">
                <h2>Accords trouv√©s avec les positions exactes :</h2>
                {% for image in exact_matches %}
                    <div class="chord-result">
                        <h3>{{ image.chord_name }} - {{ image.chord_type }}</h3>
                        <img src="{{ image.image_url }}" alt="Image de l'accord {{ image.chord_name }}">
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if other_positions %}
            <div class="result">
            {% if exact_matches %}
                <h2>Autres positions trouv√©es :</h2>
            {% else %}
                <h2 id="results">Aucun accord trouv√© pour ces positions.</h2>
                <h2>Accords les plus proches :</h2>
            {% endif %}
                {% for image in other_positions %}
                    <div class="chord-result">
                        <h3>{{ image.chord_name }} - {{ image.chord_type }}</h3>
                        <img src="{{ image.image_url }}" alt="Image de l'accord {{ image.chord_name }}">
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <script>
        // √âtat de l'application
        const appState = {
            currentString: 0,
            stringValues: ['', '', '', '', '', ''],
            stringNames: ['Mi grave', 'La', 'R√©', 'Sol', 'Si', 'Mi aigu'],
            stringLabels: ['Corde 6', 'Corde 5', 'Corde 4', 'Corde 3', 'Corde 2', 'Corde 1']
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeInterface();
            updateCurrentStringDisplay();
            updateProgress();
        });

        function initializeInterface() {
            // √âcouteurs pour les boutons de frettes
            document.querySelectorAll('.single-fret-button').forEach(button => {
                button.addEventListener('click', function() {
                    selectFret(this.dataset.value);
                });
            });

            // √âcouteurs pour la navigation
            document.getElementById('prevArrow').addEventListener('click', () => navigateToString(appState.currentString - 1));
            document.getElementById('nextArrow').addEventListener('click', () => navigateToString(appState.currentString + 1));

            // √âcouteurs pour les cases de l'accord actuel (navigation directe)
            document.querySelectorAll('.chord-string-display').forEach(display => {
                display.addEventListener('click', function() {
                    const stringIndex = parseInt(this.dataset.string);
                    navigateToString(stringIndex);
                });
                display.style.cursor = 'pointer';
            });

            // Bouton effacer
            document.getElementById('clearButton').addEventListener('click', clearAllSelections);

            // Bouton partager
            document.getElementById('shareButton').addEventListener('click', copyShareableLink);

            // Navigation clavier
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    navigateToString(appState.currentString - 1);
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    navigateToString(appState.currentString + 1);
                } else if (e.key === 'Escape') {
                    clearAllSelections();
                }
            });
        }

        function selectFret(value) {
            // Mettre √† jour l'√©tat
            appState.stringValues[appState.currentString] = value;

            // Mettre √† jour l'affichage imm√©diatement
            updateStringValue(appState.currentString, value);
            updateHiddenFields();
            updateSubmitButton();
            
            // IMPORTANT : Mettre √† jour la s√©lection visuelle des boutons imm√©diatement
            updateFretSelection();

            // Passer √† la corde suivante automatiquement (sauf si on modifie une corde d√©j√† remplie)
            if (appState.currentString < 5) {
                setTimeout(() => {
                    navigateToString(appState.currentString + 1);
                }, 300);
            }
        }

        function navigateToString(stringIndex) {
            if (stringIndex < 0 || stringIndex > 5) return;

            appState.currentString = stringIndex;
            updateCurrentStringDisplay();
            updateStringNavigation();
            updateProgress();
            updateFretSelection();
        }

        function updateCurrentStringDisplay() {
            document.getElementById('currentStringLabel').textContent = appState.stringLabels[appState.currentString];
            document.getElementById('currentStringNote').textContent = appState.stringNames[appState.currentString];

            // Mettre √† jour les fl√®ches
            document.getElementById('prevArrow').disabled = appState.currentString === 0;
            document.getElementById('nextArrow').disabled = appState.currentString === 5;

            // Mettre √† jour les indicateurs de cordes
            document.querySelectorAll('.chord-string-display').forEach((display, index) => {
                display.classList.remove('current-editing');
                if (index === appState.currentString) {
                    display.classList.add('current-editing');
                }
            });
        }

        function updateStringNavigation() {
            // Cette fonction g√®re maintenant uniquement l'√©tat visuel des cases d'accord
            document.querySelectorAll('.chord-string-display').forEach((display, index) => {
                display.classList.remove('current-editing', 'completed');
                if (index === appState.currentString) {
                    display.classList.add('current-editing');
                } else if (appState.stringValues[index]) {
                    display.classList.add('completed');
                }
            });
        }

        function updateProgress() {
            const completedStrings = appState.stringValues.filter(v => v !== '').length;
            const progress = (appState.currentString + 1) / 6 * 100;
            
            document.getElementById('progressText').textContent = `Corde ${appState.currentString + 1} sur 6`;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function updateFretSelection() {
            const currentValue = appState.stringValues[appState.currentString];
            
            document.querySelectorAll('.single-fret-button').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.value === currentValue) {
                    btn.classList.add('selected');
                }
            });
        }

        function updateStringValue(stringIndex, value) {
            document.getElementById(`stringValue${stringIndex}`).textContent = value;
            
            const display = document.querySelector(`.chord-string-display[data-string="${stringIndex}"]`);
            if (display) {
                display.classList.add('completed');
            }
        }

        function updateHiddenFields() {
            appState.stringValues.forEach((value, index) => {
                document.getElementById(`string${index}`).value = value;
            });
        }

        function updateSubmitButton() {
            const allCompleted = appState.stringValues.every(v => v !== '');
            const submitButton = document.getElementById('submitButton');
            
            submitButton.disabled = !allCompleted;
            
            if (allCompleted) {
                submitButton.textContent = 'üîç Trouver l\'accord';
            } else {
                const remaining = 6 - appState.stringValues.filter(v => v !== '').length;
                submitButton.textContent = `${remaining} corde${remaining > 1 ? 's' : ''} restante${remaining > 1 ? 's' : ''}`;
            }
        }

        function submitForm() {
            const allSelected = appState.stringValues.every(val => val !== '');
            if (!allSelected) {
                alert("Veuillez compl√©ter toutes les cordes avant de continuer.");
                return false;
            }
            
            // Encoder l'accord dans l'URL avant soumission
            updateURLWithChord();
            
            showLoader();
            return true;
        }

        function updateURLWithChord() {
            const chordParam = appState.stringValues.join(',');
            const url = new URL(window.location);
            url.searchParams.set('chord', chordParam);
            window.history.replaceState({}, '', url);
        }

        function getChordFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const chordParam = urlParams.get('chord');
            if (chordParam) {
                const chordValues = chordParam.split(',');
                if (chordValues.length === 6) {
                    return chordValues;
                }
            }
            return null;
        }

        function loadChordFromURL() {
            const chordValues = getChordFromURL();
            if (chordValues) {
                console.log('Chargement depuis URL:', chordValues);
                
                // Mettre √† jour l'√©tat
                appState.stringValues = chordValues;
                
                // Mettre √† jour les champs cach√©s et l'affichage
                chordValues.forEach((value, index) => {
                    document.getElementById(`string${index}`).value = value;
                    document.getElementById(`stringValue${index}`).textContent = value;
                    
                    const chordDisplay = document.querySelector(`.chord-string-display[data-string="${index}"]`);
                    if (chordDisplay && value !== '') {
                        chordDisplay.classList.add('completed');
                    }
                });
                
                updateSubmitButton();
                updateStringNavigation();
                updateFretSelection();
                
                // Aller √† la premi√®re corde non remplie ou rester sur 0
                let nextEmptyString = appState.stringValues.findIndex(val => val === '' || val === '-');
                if (nextEmptyString === -1) nextEmptyString = 0;
                navigateToString(nextEmptyString);
                
                return true;
            }
            return false;
        }

        function showLoader() {
            document.getElementById('loaderModal').style.display = 'flex';
        }

        // Exemple rapide
        function clearAllSelections() {
            // R√©initialiser l'√©tat
            appState.stringValues = ['', '', '', '', '', ''];
            appState.currentString = 0;
            
            // Vider tous les affichages
            for (let i = 0; i < 6; i++) {
                document.getElementById(`stringValue${i}`).textContent = '-';
                document.getElementById(`string${i}`).value = '';
            }
            
            // Nettoyer les classes CSS
            document.querySelectorAll('.chord-string-display').forEach(display => {
                display.classList.remove('completed', 'current-editing');
            });
            
            document.querySelectorAll('.single-fret-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Nettoyer l'URL
            const url = new URL(window.location);
            url.searchParams.delete('chord');
            window.history.replaceState({}, '', url);
            
            // Remettre √† jour l'interface
            updateCurrentStringDisplay();
            updateStringNavigation();
            updateProgress();
            updateSubmitButton();
        }

        function copyShareableLink() {
            if (appState.stringValues.some(val => val !== '')) {
                updateURLWithChord();
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Lien copiable cr√©√© ! Vous pouvez le partager.');
                }).catch(() => {
                    alert('URL mise √† jour dans la barre d\'adresse. Copiez-la pour partager cet accord.');
                });
            } else {
                alert('S√©lectionnez d\'abord un accord √† partager.');
            }
        }

        function loadExample() {
            const example = ['x', '3', '2', '0', '1', '0']; // C Major
            
            // Effacer d'abord
            clearAllSelections();
            
            // Charger l'exemple
            example.forEach((value, index) => {
                appState.stringValues[index] = value;
                document.getElementById(`stringValue${index}`).textContent = value;
                document.getElementById(`string${index}`).value = value;
            });
            
            updateSubmitButton();
            updateStringNavigation();
            updateFretSelection();
        }

        // Ajouter bouton d'exemple
        const exampleButton = document.createElement('button');
        exampleButton.type = 'button';
        exampleButton.textContent = 'üéµ Exemple (Do majeur)';
        exampleButton.className = 'example-button';
        exampleButton.addEventListener('click', loadExample);
        document.querySelector('.selected-values').appendChild(exampleButton);

        // Fonction pour restaurer l'√©tat (d'abord URL, puis champs cach√©s en fallback)
        function restoreState() {
            console.log('Restauration de l\'√©tat...');
            
            // Priorit√© 1 : Essayer de charger depuis l'URL
            if (loadChordFromURL()) {
                console.log('√âtat restaur√© depuis URL');
                return;
            }
            
            // Priorit√© 2 : Fallback vers les champs cach√©s (apr√®s soumission POST)
            console.log('Tentative de restauration depuis les champs cach√©s...');
            let hasValues = false;
            
            for (let i = 0; i < 6; i++) {
                const hiddenField = document.getElementById(`string${i}`);
                if (hiddenField && hiddenField.value && hiddenField.value !== '') {
                    const value = hiddenField.value;
                    console.log(`Restauration corde ${i}: ${value}`);
                    
                    // Mettre √† jour l'√©tat
                    appState.stringValues[i] = value;
                    
                    // Mettre √† jour l'affichage dans les cases
                    const displayElement = document.getElementById(`stringValue${i}`);
                    if (displayElement) {
                        displayElement.textContent = value;
                    }
                    
                    // Marquer comme compl√©t√©
                    const chordDisplay = document.querySelector(`.chord-string-display[data-string="${i}"]`);
                    if (chordDisplay) {
                        chordDisplay.classList.add('completed');
                    }
                    
                    hasValues = true;
                }
            }
            
            if (hasValues) {
                console.log('√âtat restaur√© depuis champs cach√©s:', appState.stringValues);
                updateSubmitButton();
                updateStringNavigation();
                updateFretSelection();
                
                // Aller √† la derni√®re corde non remplie ou rester sur la premi√®re
                let nextEmptyString = appState.stringValues.findIndex(val => val === '');
                if (nextEmptyString === -1) nextEmptyString = 0;
                navigateToString(nextEmptyString);
                
                // Mettre √† jour l'URL avec les donn√©es restaur√©es
                updateURLWithChord();
            }
        }

        // Chargement de la page
        window.onload = function() {
            console.log('Page charg√©e');
            
            // Restaurer l'√©tat (URL ou champs cach√©s)
            restoreState();
            
            // Scroll vers le point d'ancrage si des r√©sultats sont pr√©sents
            const anchor = document.getElementById('scroll-anchor');
            const results = document.getElementById('results');
            
            if (results && anchor) {
                console.log('Scroll vers les r√©sultats');
                setTimeout(() => {
                    anchor.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 200);
            }
        };
    </script>
</body>
</html>